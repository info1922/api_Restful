{"version":3,"sources":["../../../../src/api/resources/gereraPDF/genera.controller.js"],"names":["getMateriales","req","res","tipo","params","console","log","Material","find","populate","exec","err","materiales","status","json","ok","mensaje","datos","push","text","bold","fontSize","map","d","image","img","width","height","title","cantidad","lugar","nombre","pdfDoc","require","create","end","pipe","Lugar","lugares","m","nombreMateriales","direccion","length"],"mappings":"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","file":"genera.controller.js","sourcesContent":["import Material from '../material/material.model';\r\nimport Lugar from '../lugar/lugar.model';\r\n/* jshint ignore:start */\r\n\r\nexport default {\r\n    getMateriales(req, res) {\r\n\r\n        const tipo = req.params.tipo;\r\n        // utilizar if para materiales y lugares\r\n\r\n        if (tipo === 'materiales') {\r\n            console.log('materiales');\r\n            Material.find({}).populate('lugar').exec((err, materiales) => {\r\n                if (err) {\r\n                    return res.status(400).json({\r\n                        ok: false,\r\n                        mensaje: 'Error generando el PDF'\r\n                    });\r\n                }\r\n\r\n                var datos = [];\r\n\r\n                console.log(materiales);\r\n                datos.push([{ text: 'Imagen', bold: true, fontSize: 12 },\r\n                    { text: 'Nombre', bold: true, fontSize: 12 },\r\n                    { text: 'Cantidad', bold: true, fontSize: 12 },\r\n                    { text: 'Lugar', bold: true, fontSize: 12 }\r\n                ]);\r\n\r\n                materiales.map((d) => {\r\n                    // buscar coincidencias de id materiales en lugares-> materiales\r\n                    datos.push([{ image: d.img ? `./uploads/materiales/${d.img}` : './assets/no-imagen.png', width: 50, height: 50, },\r\n                        { text: d.title }, { text: d.cantidad },\r\n                        { text: d.lugar ? d.lugar.nombre : 'Sin asignar' }\r\n                        // { text: JSON.stringify(d.usuario) }\r\n                    ]);\r\n                });\r\n\r\n\r\n                console.log(datos);\r\n\r\n\r\n                var pdfDoc = require('./genera.service').create(datos, tipo);\r\n                pdfDoc.end();\r\n                pdfDoc.pipe(res);\r\n\r\n                // return console.log(materiales);\r\n            });\r\n        }\r\n        if (tipo === 'lugares') {\r\n            console.log('lugares');\r\n            Lugar.find({}).populate('materiales').exec((err, lugares) => {\r\n                if (err) {\r\n                    return res.status(400).json({\r\n                        ok: false,\r\n                        mensaje: 'Error generando el PDF'\r\n                    });\r\n                }\r\n\r\n                var datos = [];\r\n\r\n                console.log(lugares);\r\n                datos.push([{ text: 'Imagen', bold: true, fontSize: 12 },\r\n                    { text: 'Nombre', bold: true, fontSize: 12 },\r\n                    { text: 'Direcci贸n', bold: true, fontSize: 12 },\r\n                    { text: 'No. de materiales', bold: true, fontSize: 12 }\r\n                ]);\r\n\r\n                lugares.map((d) => {\r\n                    let materiales = d.materiales;\r\n                    materiales.map((m) => {\r\n                        let nombreMateriales = [];\r\n                        nombreMateriales.push(m.title);\r\n                        console.log(nombreMateriales);\r\n                    });\r\n                    console.log('materiales : ', materiales);\r\n                    // buscar coincidencias de id materiales en lugares-> materiales\r\n                    datos.push([{ image: d.img ? `./uploads/lugares/${d.img}` : './assets/no-imagen.png', width: 50, height: 50, },\r\n                        { text: d.nombre }, { text: d.direccion ? d.direccion : 'Sin direcci贸n' },\r\n                        {\r\n                            text: d.materiales ?\r\n                                materiales.length : 'No tiene materiales'\r\n                        }\r\n                        // { text: JSON.stringify(d.usuario) }\r\n                    ]);\r\n                });\r\n\r\n\r\n                console.log(datos);\r\n\r\n\r\n                var pdfDoc = require('./genera.service').create(datos, tipo);\r\n                pdfDoc.end();\r\n                pdfDoc.pipe(res);\r\n\r\n                // return console.log(materiales);\r\n            });\r\n        } else {\r\n            console.log('Colecci贸n incorrecta');\r\n            return res.status(400).json({ ok: false, mensaje: 'Colecci贸n incorrecta' });\r\n        }\r\n\r\n\r\n\r\n        // return res.status(200).json({ ok: true, mensaje: 'Generando pdf' });\r\n\r\n    }\r\n\r\n\r\n};"]}