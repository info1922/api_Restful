{"version":3,"sources":["../../../src/api/middlewares/passport-facebook.js"],"names":["configureFacebookStrategy","passport","use","FacebookStrategy","Strategy","clientID","devConfig","facebook","app_id","clientSecret","app_secret","callbackURL","profileFields","accessToken","refreshToken","profile","done","console","log","name","givenName","familyName","id","User","findOne","user","newUser","nombre","apellido","token","displayName","email","emails","value","save"],"mappings":";;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA;AACO,IAAMA,gEAA4B,SAA5BA,yBAA4B,GAAM;;AAE3CC,uBAASC,GAAT,CAAa,IAAIC,2BAAiBC,QAArB,CAA8B;AACnCC,kBAAUC,uBAAUC,QAAV,CAAmBC,MADM;AAEnCC,sBAAcH,uBAAUC,QAAV,CAAmBG,UAFE;AAGnCC,qBAAaL,uBAAUC,QAAV,CAAmBI,WAHG;AAInCC,uBAAe,CAAC,IAAD,EAAO,aAAP,EAAsB,QAAtB,EAAgC,MAAhC;AAJoB,KAA9B;AAAA,4FAOT,iBAAeC,WAAf,EAA4BC,YAA5B,EAA0CC,OAA1C,EAAmDC,IAAnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAIQC,oCAAQC,GAAR,CAAY,2BAAZ,EAAyCH,QAAQI,IAAR,CAAaC,SAAtD;AACAH,oCAAQC,GAAR,CAAY,6BAAZ,EAA2CH,QAAQI,IAAR,CAAaE,UAAxD;AACAJ,oCAAQC,GAAR,CAAY,MAAZ,EAAoBH,QAAQO,EAA5B;AANR;AAAA,mCAO2BC,kBAAKC,OAAL,CAAa,EAAE,eAAeT,QAAQO,EAAzB,EAAb,CAP3B;;AAAA;AAOcG,gCAPd;;AAAA,iCAUYA,IAVZ;AAAA;AAAA;AAAA;;AAWYR,oCAAQC,GAAR,CAAY,oCAAZ;AAXZ,6DAYmBF,KAAK,IAAL,EAAWS,IAAX,CAZnB;;AAAA;AAecC,mCAfd,GAewB,IAAIH,iBAAJ,CAAS,EAAT,CAfxB;;AAgBQG,oCAAQC,MAAR,GAAiBZ,QAAQI,IAAR,CAAaC,SAA9B;AACAM,oCAAQE,QAAR,GAAmBb,QAAQI,IAAR,CAAaE,UAAhC;AACAK,oCAAQnB,QAAR,CAAiBe,EAAjB,GAAsBP,QAAQO,EAA9B;AACAI,oCAAQnB,QAAR,CAAiBsB,KAAjB,GAAyBhB,WAAzB;AACAa,oCAAQnB,QAAR,CAAiBuB,WAAjB,GAA+Bf,QAAQe,WAAvC;AACAJ,oCAAQnB,QAAR,CAAiBwB,KAAjB,GAAyBhB,QAAQiB,MAAR,CAAe,CAAf,EAAkBC,KAA3C;;AArBR;AAAA,mCAuBcP,QAAQQ,IAAR,EAvBd;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AA0BQjB,oCAAQC,GAAR,CAAY,sCAAZ;AA1BR,6DA2BeF,iBA3Bf;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAPS;;AAAA;AAAA;AAAA;AAAA,QAAb;AAwCH,CA1CM","file":"passport-facebook.js","sourcesContent":["import passport from 'passport';\r\nimport FacebookStrategy from 'passport-facebook';\r\nimport { devConfig } from '../resources/config/env/development';\r\nimport User from '../resources/usuario/usuario.model';\r\n\r\n/* jshint ignore:start */\r\nexport const configureFacebookStrategy = () => {\r\n\r\n    passport.use(new FacebookStrategy.Strategy({\r\n            clientID: devConfig.facebook.app_id,\r\n            clientSecret: devConfig.facebook.app_secret,\r\n            callbackURL: devConfig.facebook.callbackURL,\r\n            profileFields: ['id', 'displayName', 'emails', 'name']\r\n        },\r\n\r\n        async function(accessToken, refreshToken, profile, done) {\r\n\r\n            try {\r\n\r\n                console.log('Nombre usuario facebook: ', profile.name.givenName);\r\n                console.log('Apellido usuario facebook: ', profile.name.familyName);\r\n                console.log('id: ', profile.id);\r\n                const user = await User.findOne({ 'facebook.id': profile.id });\r\n\r\n\r\n                if (user) {\r\n                    console.log('Este usuario de facebook ya existe');\r\n                    return done(null, user);\r\n                }\r\n\r\n                const newUser = new User({});\r\n                newUser.nombre = profile.name.givenName;\r\n                newUser.apellido = profile.name.familyName;\r\n                newUser.facebook.id = profile.id;\r\n                newUser.facebook.token = accessToken;\r\n                newUser.facebook.displayName = profile.displayName;\r\n                newUser.facebook.email = profile.emails[0].value;\r\n\r\n                await newUser.save();\r\n\r\n            } catch (error) {\r\n                console.log('Algo salio mal, intentalo nuevamente', error);\r\n                return done(error);\r\n            }\r\n        }\r\n\r\n    ));\r\n\r\n};"]}